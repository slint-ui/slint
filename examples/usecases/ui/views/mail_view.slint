// Copyright Â© SixtyFPS GmbH <info@slint.dev>
// SPDX-License-Identifier: MIT

import { GroupBox, ComboBox, VerticalBox, GroupBox, GridBox, Palette, TextEdit, Button, Switch, ScrollView } from "std-widgets.slint";
import { NavigationListView, NavigationListViewItem, Container, ExtendedLineEdit, Icon, CardListView, CardListViewItem, IconButton, TitleText } from "../widgets.slint";
import { Icons } from "../assets.slint";

export global MailViewAdapter { }

export global MailSideBarViewAdapter {
    callback account-selected(/* index */ int);
    callback box-selected(/* account */ int, /* box */ int);
    callback custom-box-selected(/* account */ int, /* box */ int);

    in-out property <int> current-account;
    in property <[string]> accounts: ["jon.doe@slint.dev", "jon.doe@my-mail.com", "jon.doe@gmail.com"];
    out property <string> current-account-value: root.accounts[root.current-account];

    in property <[NavigationListViewItem]> boxes: [
        { text: "Inbox", message: "128", icon: Icons.inbox },
        { text: "Drafts", message: "9", icon: Icons.document },
        { text: "Sent", icon: Icons.send },
        {
            text: "Junk",
            icon: Icons.junk,
            message: "23",
        },
        { text: "Trash", icon: Icons.trash },
        { text: "Archive", icon: Icons.archive }
    ];
    out property <string> current-box-value: root.boxes[root.current-box].text;

    in property <[NavigationListViewItem]> custom-boxes: [
        { text: "Social", message: "3972", icon: Icons.useres },
        { text: "Updates", message: "342", icon: Icons.updates },
        { text: "Forums", message: "128", icon: Icons.message }
    ];
    out property <string> current-custom-box-value: root.custom-boxes[root.current-custom-box].text;

    in-out property <int> current-box;
    in-out property <int> current-custom-box: -1;

    public function raise-box-selected(index: int) {
        root.box-selected(root.current-account, index);
    }

    public function raise-custom-box-selected(index: int) {
        root.custom-box-selected(root.current-account, index);
    }

    public pure function current-title() -> string {
        if current-box > -1 && current-box < boxes.length {
            return boxes[current-box].text;
        }
        if current-custom-box > -1 && current-custom-box < custom-boxes.length {
            return custom-boxes[current-custom-box].text;
        }
        ""
    }
}

export component MailSideBarView {
    horizontal-stretch: 0;
    min-width: 264px / 2;

    VerticalLayout {
        spacing: 4px;

       cb :=  ComboBox {
            model: MailSideBarViewAdapter.accounts;
            current-index <=> MailSideBarViewAdapter.current-account;

            selected(account) => {
                MailSideBarViewAdapter.account_selected(cb.current-index);
            }
        }

        container := Container {
            NavigationListView {
                model: MailSideBarViewAdapter.boxes;
                current-item <=> MailSideBarViewAdapter.current-box;
                min-height: 248px;
                vertical-stretch: 0;

                selected(index) => {
                    MailSideBarViewAdapter.raise-box-selected(index);
                    MailSideBarViewAdapter.current-custom-box = -1;
                }
            }

            Rectangle {
                background: Palette.border;
                height: 1px;
            }

            NavigationListView {
                model: MailSideBarViewAdapter.custom-boxes;
                current-item <=> MailSideBarViewAdapter.current-custom-box;

                selected(index) => {
                    MailSideBarViewAdapter.raise-custom-box-selected(index);
                    MailSideBarViewAdapter.current-box = -1;
                }
            }
        }
    }
}

export global MailBoxViewAdapter {
    callback search-text-changed(/* search-text */ string);

    in property <string> title: MailSideBarViewAdapter.current-title();
    in property <[CardListViewItem]> mails: [
        {
            title: "Simon Hausmann",
            note: "1 hour ago",
            sub-title: "Meeting tomorrow",
            caption: "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat."
        },
        { title: "Tobias Hunger", note: "1 day ago", sub-title: "Meeting tomorrow",  caption: "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat." },
        {
            title: "Olivier Goffart",
            note: "2 hour ago",
            sub-title: "Meeting tomorrow",
            caption: "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat."
        },
        {
            title: "Aurindam Jana",
            note: "5 hour ago",
            sub-title: "Meeting tomorrow",
            caption: "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat."
        },
        {
            title: "Simon Hausmann",
            note: "7 hour ago",
            sub-title: "Meeting tomorrow",
            caption: "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat."
        },
        { title: "Tobias Hunger", note: "1 day ago", sub-title: "Meeting tomorrow",  caption: "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat." },
        {
            title: "Olivier Goffart",
            note: "8 hour ago",
            sub-title: "Meeting tomorrow",
            caption: "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat."
        },
        {
            title: "Aurindam Jana",
            note: "9 hour ago",
            sub-title: "Meeting tomorrow",
            caption: "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat."
        },
    ];
}

export component MailBoxView {
    horizontal-stretch: 1;

    VerticalLayout {
        spacing: 4px;

        TitleText {
            text: MailBoxViewAdapter.title;
            min-height: 32px;

        }

        Container {
            background: Palette.control-background;

            VerticalLayout {
                spacing: 8px;

                ExtendedLineEdit {
                    vertical-stretch: 0;
                    placeholder-text: "Search by Sender";

                    Icon {
                        source: Icons.search;
                    }

                    edited => {
                        MailBoxViewAdapter.search-text-changed(self.text);
                    }
                }

                CardListView {
                    model: MailBoxViewAdapter.mails;
                }
            }
        }
    }
}

export global MailMessageViewAdapter {
    callback move-to-archive();
    callback move-to-junk();
    callback move-to-trash();
    callback reply();
    callback forward();
    callback send();

    in property <string> message: "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.";
    in-out property <bool> mute-this-thread: false;
}

export component MailMessageView {
    horizontal-stretch: 1;

    Container {
        background: Palette.control-background;

        HorizontalLayout {
            spacing: 8px;

            IconButton {
                icon: Icons.archive;

                clicked => {
                    MailMessageViewAdapter.move-to-archive();
                }
            }

            IconButton {
                icon: Icons.junk;

                clicked => {
                    MailMessageViewAdapter.move-to-junk();
                }
            }

            IconButton {
                icon: Icons.trash;

                clicked => {
                    MailMessageViewAdapter.move-to-trash();
                }
            }

            Rectangle {}

            IconButton {
                icon: Icons.reply;

                clicked => {
                    MailMessageViewAdapter.reply();
                }
            }

            IconButton {
                icon: Icons.forward;

                clicked => {
                    MailMessageViewAdapter.forward();
                }
            }
        }

        VerticalBox {
            text-edit := TextEdit {
                max-height: 94px;
                wrap: word-wrap;
            }

            ScrollView {
                Text {
                    y: 0;
                    vertical-alignment: top;
                    width: parent.width;
                    font-size: 14px;
                    font-weight: 400;
                    color: Palette.foreground;
                    text: MailMessageViewAdapter.message;
                    wrap: word-wrap;
                }
            }

            HorizontalLayout {
                Switch {
                    text: "Mute this thread";
                    checked <=> MailMessageViewAdapter.mute-this-thread;
                }

                Button {
                    text: "Send";
                    primary: true;
                    enabled: text-edit.text != "";

                    clicked => {
                        MailMessageViewAdapter.send();
                    }
                }
            }
        }
    }
}

export component MailView {
    HorizontalLayout {
        spacing: 16px;

        MailSideBarView { }

        VerticalLayout {
            spacing: 16px;

            MailBoxView { }
            MailMessageView {}
        }
    }
}
