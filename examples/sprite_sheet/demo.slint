// Copyright Â© SixtyFPS GmbH <info@slint.dev>
// SPDX-License-Identifier: MIT

import { ComboBox } from "std-widgets.slint";
import { SpriteSheet } from "SpriteSheet.slint";

enum TravelDirection { left, right }

export component AppWindow inherits Window {
    preferred-width: 1024px;
    preferred-height: 720px;

    property <TravelDirection> travel-direction: TravelDirection.right;

    cb := ComboBox {
        x: 10px;
        y: 10px;
        model: ["Boing Ball", "Static"];
        current-value: "Boing Ball";
    }

    if cb.current-value == "Static": SpriteSheet {
        source: @image-url("images/sprite.png");
        frames-wide: 5;
        frames-high: 5;
        total-frames: 21;
        playing: true;
        duration: 700ms;
    }

    if cb.current-value == "Boing Ball":  ball := SpriteSheet {
        property <int> frame-base;
        function updateX(){
       
            if ball.x > root.width - ball.width {
                travel-direction = TravelDirection.left;
                frame-base = self.frame;
                ball.x = 0;
            }
            if ball.x <= 0 {
                travel-direction = TravelDirection.right;
                frame-base = self.frame;
                ball.x = root.width;
            }
        }
        
        source: @image-url("images/sprite.png");
        frames-wide: 5;
        frames-high: 5;
        total-frames: 21;
        x: 0px;
        animate x { duration: 3s; }
        y: (-400px * abs(sin(360deg * animation-tick() / 3s))) + parent.height - ball.height;
        frame: frame-base + (travel-direction == TravelDirection.left ? 1 : -1) * animation-tick() / 16ms;
        changed frame => {
            debug(self.frame);
        }
        changed x => { updateX() }

        // Update X on start or the ball will be stuck at 0 as no 'changed x' happens
        init => { updateX() }
    }
}
