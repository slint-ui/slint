// Copyright Â© SixtyFPS GmbH <info@slint.dev>
// SPDX-License-Identifier: MIT

// cSpell: ignore noto subpage

import { DemoPalette, Page } from "common.slint";
import { HomePage } from "./home_page.slint";
import { InkLevel, InkPage } from "./ink_page.slint";
import { SettingsPage } from "./settings_page.slint";
import { PrinterQueue } from "./printer_queue.slint";

// re-export for the native code
export { PrinterQueue }

import "./fonts/Inter-24pt-Regular.ttf";
import "./fonts/Inter-24pt-Medium.ttf";

component SideBarIcon inherits Rectangle {
    in-out property <bool> active;
    in-out property icon <=> icon.source;
    in-out property <color> icon-colorize: active ? DemoPalette.active-page-icon-color : DemoPalette.inactive-page-icon-color;

    callback activate;
    width: 30px;
    height: self.width;

    Rectangle {
        width: 120%;
        height: self.width;
        border-radius: self.width / 3;
        visible: active;
        background: white;
    }

    icon := Image {
        colorize: icon-colorize;
        image-fit: contain;
        width: 24px;
        height: self.width;
    }

    TouchArea {
        pointer-event(event) => {
            if (event.button == PointerEventButton.left && event.kind == PointerEventKind.down) {
                root.activate();
            }
        }

        width: 170%;
        height: 150%;
    }
}

export component MainWindow inherits Window {
    min-width: 320px;
    min-height: 240px;
    preferred-width: self.min-width;
    preferred-height: self.min-height;
    title: "Slint printer demo";
    background: DemoPalette.main-background;
    default-font-family: DemoPalette.medium-font-family;
    default-font-size: DemoPalette.base-font-size;

    /// Note that this property is overwritten in the .cpp and .rs code.
    /// The data is only in this file so it looks good in the viewer
    in-out property <[InkLevel]> ink-levels: [
                {color: #0ff, level: 60%},
                {color: #ff0, level: 80%},
                {color: #f0f, level: 70%},
                {color: #000, level: 30%},
            ];

    in-out property <int> active-page: 0;

    callback quit();

    main-view := Rectangle {
        property <length> margin: 5px;

        x: sidebar.x + sidebar.width;
        y: self.margin;
        height: parent.height - self.margin * 2;
        width: parent.width - self.x - self.margin;
        border-radius: 15px;
        background: DemoPalette.page-background-color;

        Rectangle {
            clip: true;
            x: main-view.border-radius / 2;
            y: main-view.border-radius / 2;
            width: main-view.width - main-view.border-radius;
            height: main-view.height - main-view.border-radius;

            home-page := HomePage {
                visible: root.active-page == 0;
            }

            SettingsPage {
                visible: root.active-page == 1;
            }

            InkPage {
                visible: root.active-page == 2;
                ink-levels <=> root.ink-levels;
                page-visible: root.active-page == 2;
            }
        }
    }


    sidebar := Rectangle {
        function icon-y(index: int) -> length {
            return index * 50px;
        }


        width: 49px;
        x: 5px;

        VerticalLayout {
            width: self.preferred-width;
            padding-top: main-view.margin * 2;
            spacing: 16px;
            for page-icon[idx] in [
                @image-url("images/mcu/home.svg"),
                @image-url("images/mcu/settings.svg"),
                @image-url("images/mcu/ink.svg"),
            ] : SideBarIcon {

                activate => {
                    home-page.current-subpage = 0;
                    root.active-page = idx;
                }
                icon: page-icon;
                active: root.active-page == idx;
            }
        }


        SideBarIcon {
            activate => {
                DemoPalette.night-mode = !DemoPalette.night-mode;
            }

            y: parent.height - self.height - main-view.margin * 2;
            x: (parent.width - self.width) / 2;
            icon: @image-url("images/mcu/theme.svg");
            icon-colorize: DemoPalette.night-mode ? #F1FF98 : DemoPalette.inactive-page-icon-color;

        }
    }
}
