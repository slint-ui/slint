// Copyright Â© SixtyFPS GmbH <info@slint.dev>
// SPDX-License-Identifier: MIT

import { CheckBox, Label, DemoPalette, KioskState, PrinterState } from "../common.slint";
import { Page, Header } from "./page.slint";
import { DropDownMenu } from "../components/drop_down_menu.slint";

export global PrinterSettings {
    callback change-language(int);
}

export component SettingsPage inherits Page {
    header: @tr("Settings");
    header-type: Header.plain;


    in-out property <bool> kiosk-sequence-running <=> KioskState.settings-active;
    in-out property <bool> turbo-mode <=> KioskState.settings-turbo-mode;
    in-out property <bool> eco-mode <=> KioskState.settings-eco-mode;
    in-out property <bool> sort-pages <=> KioskState.settings-sort-pages;
    in-out property <int> layout-index <=> KioskState.settings-layout-index;
    in-out property <int> tray-index <=> KioskState.settings-tray-index;
    in-out property <int> quality-index <=> KioskState.settings-quality-index;
    in-out property <int> language-index <=> KioskState.settings-language-index;
    in-out property <int> color-mode-index <=> KioskState.settings-color-mode-index;

    property <int> kiosk-sequence-step: 0;

    function advance-kiosk-sequence() {
        if (kiosk-sequence-step == 0) {
            KioskState.settings-turbo-mode = !KioskState.settings-turbo-mode;
        } else if (kiosk-sequence-step == 1) {
            KioskState.settings-eco-mode = !KioskState.settings-eco-mode;
        } else if (kiosk-sequence-step == 2) {
            KioskState.settings-sort-pages = !KioskState.settings-sort-pages;
        } else if (kiosk-sequence-step == 3) {
            KioskState.settings-layout-index = mod(KioskState.settings-layout-index + 1, 2);
        } else if (kiosk-sequence-step == 4) {
            KioskState.settings-tray-index = mod(KioskState.settings-tray-index + 1, 3);
        } else if (kiosk-sequence-step == 5) {
            KioskState.settings-quality-index = mod(KioskState.settings-quality-index + 1, 3);
        } else if (kiosk-sequence-step == 6) {
            KioskState.settings-language-index = mod(KioskState.settings-language-index + 1, 2);
            PrinterSettings.change_language(KioskState.settings-language-index);
        } else if (kiosk-sequence-step == 7) {
            KioskState.settings-color-mode-index = mod(KioskState.settings-color-mode-index + 1, 2);
        } else {
            kiosk-sequence-running = false;
            return;
        }

        kiosk-sequence-step += 1;
    }

    changed kiosk-sequence-running => {
        if (kiosk-sequence-running) {
            kiosk-sequence-step = 0;
        }
    }

    kiosk-sequence-timer := Timer {
        interval: 1s;
        running: kiosk-sequence-running;
        triggered => {
            root.advance-kiosk-sequence();
        }
    }

    GridLayout {
        padding: DemoPalette.default-margin;
        spacing: 16px;
        width: parent.width;
        height: self.preferred-height;
        Row {
            Text {
                colspan: 4;
                text: @tr("General");
                color: DemoPalette.secondary-foreground-color;
                font-size: DemoPalette.base-font-size * 1.125;
            }
        }

        Row {
            Label {
                font-size: 18px;
                text: @tr("TURBO mode");
            }

            CheckBox {
                checked <=> root.turbo-mode;
            }

            Rectangle { }

            Label {
                text: @tr("Power Management");
            }

            CheckBox {
                checked <=> root.eco-mode;
                text: @tr("Eco Mode");
            }
        }

        Row {
            Text {
                colspan: 4;
                text: @tr("Defaults");
                color: DemoPalette.secondary-foreground-color;
                font-size: DemoPalette.base-font-size * 1.125;
            }
        }

        Row {
            Label {
                text: @tr("Layout");
            }

            DropDownMenu {
                items: [@tr("Portrait"), @tr("Landscape")];
                current_index <=> root.layout-index;
            }

            Rectangle { }

            Label {
                text: @tr("Paper Tray");
            }

            DropDownMenu {
                items: [@tr("Special Tray"), @tr("Tray 1"), @tr("Tray 2")];
                current_index <=> root.tray-index;
            }
        }

        Row {
            Label {
                text: @tr("Quality");
            }

            DropDownMenu {
                items: [@tr("Best"), @tr("Medium"), @tr("Draft")];
                current_index <=> root.quality-index;
            }

            Rectangle { }

            Label {
                text: @tr("Language");
            }

            DropDownMenu {
                items: [@tr("English"), @tr("French")];
                current_index <=> root.language-index;
                selected(index) => {
                    PrinterSettings.change_language(index);
                }
            }
        }

        Row {
            Label {
                text: @tr("Color Mode");
            }

            DropDownMenu {
                items: [@tr("Grayscale"), @tr("Color")];
                current_index <=> root.color-mode-index;
            }

            Rectangle { }

            Label {
                text: @tr("Paper Handling");
            }

            CheckBox {
                checked <=> root.sort-pages;
                text: @tr("Sort Pages");
            }
        }

        Row {
            Rectangle { }
        }
    }
}
