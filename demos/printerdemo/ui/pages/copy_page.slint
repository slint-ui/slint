// Copyright Â© SixtyFPS GmbH <info@slint.dev>
// SPDX-License-Identifier: MIT

import { PrinterQueue } from "./printer_queue.slint";
import { Page } from "./page.slint";
import { SpinBox } from "../components/spinbox.slint";
import { DropDownMenu } from "../components/drop_down_menu.slint";
import { TextButton } from "../components/text_button.slint";
import { IconTextButton } from "../components/icon_text_button.slint";
import { DemoPalette, PrinterState, SubPage, KioskState } from "../common.slint";

export component CopyPage inherits Page {
    header: @tr("Copy");
    subtitle: @tr("Choose Settings");

    in-out property <int> copies: 1;
    in-out property <bool> is-color: true;
    in-out property <int> quality-index: 0;
    in-out property <int> size-index: 0;
    in-out property <int> paper-size-index: 0;
    in-out property <int> layout-index: 0;

    in-out property <bool> kiosk-sequence-running <=> KioskState.copy-sequence-active;
    property <int> kiosk-sequence-step: 0;

    function advance-kiosk-sequence() {
        if (kiosk-sequence-step == 0) {
            root.copies = 3;
        } else if (kiosk-sequence-step == 1) {
            root.is-color = true;
        } else if (kiosk-sequence-step == 2) {
            root.quality-index = 1;
        } else if (kiosk-sequence-step == 3) {
            root.size-index = 1;
        } else if (kiosk-sequence-step == 4) {
            root.paper-size-index = 1;
        } else if (kiosk-sequence-step == 5) {
            root.layout-index = 0;
            kiosk-sequence-running = false;
            return;
        }

        kiosk-sequence-step += 1;
    }

    changed kiosk-sequence-running => {
        if (kiosk-sequence-running) {
            kiosk-sequence-step = 0;
            kiosk-sequence-running = true;
        }
    }

    kiosk-sequence-timer := Timer {
        interval: 1s;
        running: kiosk-sequence-running;
        triggered => {
            root.advance-kiosk-sequence();
        }
    }

    GridLayout {
        padding: DemoPalette.default-margin;
        spacing: 16px;
        width: parent.width;
        height: self.preferred-height;

        property <length> item-width: (parent.width - self.spacing - self.padding * 2) / 2;

        Row {
            SpinBox {
                width: self.preferred-width;
                value <=> root.copies;
                minimum: 1;
                label: @tr("Copies");
            }

            TextButton {
                property <bool> is-color <=> root.is-color;
                width: item-width;
                text: is-color ? @tr("Color") : @tr("Grayscale");
                background: is-color ? DemoPalette.color-button-gradient : DemoPalette.grayscale-button-gradient;

                clicked => {
                    is-color = !is-color;
                }
            }
        }
        Row {
            DropDownMenu {
                width: item-width;
                label: @tr("Quality");
                items: [@tr("Best"), @tr("Medium"), @tr("Draft")];
                current_index <=> root.quality-index;
            }

            DropDownMenu {
                width: item-width;
                label: @tr("Size");
                items: ["100%","75%", "50%"];
                current_index <=> root.size-index;
            }
        }
        Row {
            DropDownMenu {
                width: item-width;
                label: @tr("Paper Size");
                items: [@tr("Original"), @tr("A4")];
                current_index <=> root.paper-size-index;
            }

            DropDownMenu {
                width: item-width;
                label: @tr("Layout");
                items: [@tr("Portrait"), @tr("Landscape")];
                current_index <=> root.layout-index;
            }
        }
        Row {
            IconTextButton {
                colspan: 2;
                icon: @image-url("../images/scan.svg");
                font-size: 18px;
                text: @tr("Start copying");
                height: 60px;
                icon-color: white;
                text-color: white;
                clicked => {
                    PrinterQueue.start-job(@tr("Copy"));
                    PrinterState.active-subpage = SubPage.none;
                }
            }
        }
    }
}
