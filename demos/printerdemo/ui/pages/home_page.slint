// Copyright Â© SixtyFPS GmbH <info@slint.dev>
// SPDX-License-Identifier: MIT

import { DemoPalette, Theme } from "../common.slint";
import { CopyPage } from "./copy_page.slint";
import { ScanPage } from "./scan_page.slint";
import { PrintPage } from "./print_page.slint";
import { PrinterQueueView } from "../printer_queue.slint";
import { UsbPage } from "./usb_page.slint";
import { Page } from "./page.slint";

enum SubPage { None, Print, Scan, Copy, Usb }

component ActionButton inherits Rectangle {
    in property <image> icon <=> img.source;
    in property <string> text <=> label.text;

    width: DemoPalette.button-width;
    height: DemoPalette.button-height;
    border-radius: 25px;
    background: DemoPalette.theme != Theme.Gradient ? DemoPalette.primary : DemoPalette.background;

    callback clicked;

    VerticalLayout {
        spacing: 10px;
        width: self.preferred-width;
        height: self.preferred-height;

        Rectangle {
            width: 64px;
            height: self.width;
            background: white.with-alpha(0.2);
            border-radius: 16px;

            img := Image {
                width: 32px;
                colorize: white;
            }
        }

        label := Text {
            font-size: 18px;
            font-weight: 300;
            horizontal-alignment: center;
            color: white;
        }
    }

    TouchArea {
        clicked => {
            root.clicked()
        }
    }
}

export component HomePage inherits Page {
    in-out property <length> header-row-height: 40px;
    in-out property <length> button-spacing: 35px;
    in-out property <SubPage> current-subpage: SubPage.None;

    header: @tr("Slint Printer Demo");
    has-header: false;

    GridLayout {
        x: DemoPalette.default-margin;
        y: parent.height - DemoPalette.default-margin - self.preferred-height;
        width: self.preferred-width;
        height: self.preferred-height;
        spacing: 16px;

        for action[index] in [
            {
                name: @tr("Print"),
                id: SubPage.Print,
                icon: @image-url("../images/print.svg"),
                background:  @linear-gradient(-45deg, #2B7FFF 0%, #155DFC 100%)
            },
            {
                name: @tr("Scan"),
                id: SubPage.Scan,
                icon: @image-url("../images/scan.svg"),
                background:  @linear-gradient(-45deg, #00BC7D 0%, #009966 100%)
            },
            {
                name: @tr("Copy"),
                id: SubPage.Copy,
                icon: @image-url("../images/copy.svg"),
                background:  @linear-gradient(-45deg, #FF2056 0%, #fd3d6d 100%)
            },
            {
                name: @tr("USB"),
                id: SubPage.Usb,
                icon: @image-url("../images/usb.svg"),
                background:  @linear-gradient(-45deg, #FF6900 0%, #F54900 100%)
            },
        ]: ActionButton {
            col: index.mod(2);
            row: index / 2;
            icon: action.icon;
            text: action.name;
            background: action.background;
            clicked => {
                root.current-subpage = action.id;
            }
        }
    }

    queue-view := PrinterQueueView {
        show-job-details(idx) => {
            root.current-subpage = SubPage.Print;
        }

        x: parent.width - self.width;
        width: 313px;
    }

    PrintPage {
        back => {
            root.current-subpage = SubPage.None;
        }
        x: root.current-subpage == SubPage.Print ? 0 : parent.width + parent.x + 2px;
        animate x {
            duration: 125ms;
            easing: ease;
        }
    }

    ScanPage {
        back => {
            root.current-subpage = SubPage.None;
        }
        x: root.current-subpage == SubPage.Scan ? 0 : parent.width + parent.x + 2px;
        animate x {
            duration: 125ms;
            easing: ease;
        }
    }

    CopyPage {
        back => {
            root.current-subpage = SubPage.None;
        }
        x: root.current-subpage == SubPage.Copy ? 0 : parent.width + parent.x + 2px;
        animate x {
            duration: 125ms;
            easing: ease;
        }
    }

    UsbPage {
        back => {
            root.current-subpage = SubPage.None;
        }
        x: root.current-subpage == SubPage.Usb ? 0 : parent.width + parent.x + 2px;
        animate x {
            duration: 125ms;
            easing: ease;
        }
    }
}
