// Copyright Â© SixtyFPS GmbH <info@slint.dev>
// SPDX-License-Identifier: MIT

import { DemoPalette, Theme, PrinterState, Label } from "common.slint";
import {
    HomePage,
    InkLevel,
    InkPage,
    SettingsPage,
    PrinterSettings,
} from "./pages/pages.slint";
import { PrinterQueue } from "./printer_queue.slint";
import { Sidebar } from "components/sidebar.slint";

// re-export for the native code
export { PrinterQueue, PrinterSettings }

import "./fonts/Inter-24pt-Regular.ttf";
import "./fonts/Inter-24pt-Medium.ttf";
import "./fonts/Inter-24pt-SemiBold.ttf";
import "./fonts/Inter-24pt-Bold.ttf";

export component MainWindow inherits Window {
    /// Note that this property is overwritten in the .cpp and .rs code.
    /// The data is only in this file so it looks good in the viewer
    in property <[InkLevel]> ink-levels: [
        { color: #0ff, level: 60% },
        { color: #ff0, level: 80% },
        { color: #f0f, level: 70% },
        { color: #000, level: 30% },
    ];

    callback quit();

    min-width: 772px;
    min-height: 504px;
    title: @tr("Slint printer demo");
    default-font-family: DemoPalette.medium-weight;
    default-font-size: DemoPalette.base-font-size;

    Rectangle {
        border-radius: 24px;
        clip: true;
        background: green;
        HorizontalLayout {

            side-bar := Sidebar {
                select-theme => {
                    popup.show();
                }
            }

            main-view := Rectangle {
                if PrinterState.active-page == 0:home-page := HomePage {
                    property <int> pageNumber: 0;
                }
                if PrinterState.active-page == 1:settings-page := SettingsPage {
                    property <int> pageNumber: 1;
                }
                ink-page := InkPage {
                    property <int> pageNumber: 2;
                    ink-levels <=> root.ink-levels;
                    visible: PrinterState.active-page == 2;
                }
            }
        }

        popup := PopupWindow {
            x: side-bar.width + 10px;
            y: root.height - self.preferred-height - 10px;
            width: 200px;
            property <[Theme]> items: [Theme.Gradient, Theme.Minimalist, Theme.Vibrant, Theme.Glass];

            Rectangle {
                background: DemoPalette.background;
                border-radius: 14px;
                border-width: 2px;
                border-color: DemoPalette.secondary;
                clip: true;

                content := VerticalLayout {
                    for value[idx] in items: Rectangle {
                        property <int> current_index: DemoPalette.theme == value ? idx : -1;
                        background: idx == current_index ? DemoPalette.secondary.transparentize(0.6) : item-area.has-hover ? DemoPalette.secondary.transparentize(0.8) : #0000;
                        height: 60px;

                        HorizontalLayout {
                            padding: 20px;
                            Label {
                                text: DemoPalette.theme-label(value);
                                color: idx == current_index ? #f54d07 : item-area.has-hover ? DemoPalette.primary : DemoPalette.text-primary;
                            }
                        }

                        item-area := TouchArea {
                            clicked => {
                                DemoPalette.theme = value;
                            }
                        }
                    }
                }
            }
        }
    }
}
