// Copyright Â© SixtyFPS GmbH <info@slint.dev>
// SPDX-License-Identifier: GPL-3.0-only OR LicenseRef-Slint-Royalty-free-2.0 OR LicenseRef-Slint-Software-3.0

// Test case for issue #7402: Init callback accessing geometry properties
// https://github.com/slint-ui/slint/issues/7402
//
// The problem is that init callbacks may be triggered during layout computation.
// When the callback tries to access geometry properties that depend on the layout
// being evaluated, it can create a circular dependency.
//
// Note: This specific pattern (VerticalLayout + Rectangle + init + absolute-position)
// does not currently panic but returns 0 for geometry properties during init.
// The recursion panic issue is more likely to occur with ComponentContainer.
//
// Only run on Rust interpreter - ComponentFactory not supported in C++/JS
//ignore: cpp,js,pyi

export global TestResults {
    in-out property <length> captured-y: 0px;
}

export component TestCase inherits Window {
    width: 300px;
    height: 300px;

    VerticalLayout {
        Rectangle {
            background: blue;
            height: 50px;
        }
        // ComponentContainer is key to triggering the issue because its layout_info
        // calls ensure_updated() which runs init callbacks during layout evaluation
        container := ComponentContainer {
        }
    }

    in property <component-factory> factory <=> container.component-factory;
    // Test passes if no panic occurs - the actual geometry value isn't verified here
    // because the issue is that accessing geometry in init can cause recursion
    out property <bool> test: true;
}

/*
```rust
// Test that the component with ComponentContainer can be created without panic
// The full issue #7402 test with embedded component is tested manually
let _instance = TestCase::new().unwrap();
```
*/
