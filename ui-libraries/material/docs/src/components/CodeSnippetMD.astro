---
// Copyright Â© SixtyFPS GmbH <info@slint.dev>
// SPDX-License-Identifier: MIT
import "@astrojs/starlight/style/markdown.css";
import type { ImageMetadata } from "astro";
import { Image } from "astro:assets";

interface Props {
    imagePath: string;
    imageAlt: string;
    imageWidth: number;
    imageHeight: number;
    needsBackground?: boolean;
    skip?: boolean;
    scale?: number;
}
const { imagePath, imageAlt, skip, needsBackground } = Astro.props as Props;
const images = import.meta.glob<{ default: ImageMetadata }>(
    "/src/assets/generated/*.{jpeg,jpg,png,gif}",
);
if (imagePath.length > 0 && !images[imagePath]) {
    throw new Error(
        `"${imagePath}" does not exist in glob: "src/assets/generated/*.{jpeg,jpg,png,gif}"`,
    );
}
const imageSrc = imagePath.length > 0 ? images[imagePath]() : "";
const imageCSS = `image-block ${needsBackground ? "screenshot-container" : ""}`;
---

{!skip && <div class="code-image-container">
    <div class="code-block">
        <slot/>
    </div>

    {imageSrc && <div class={imageCSS}>
        <Image src={imageSrc} alt={imageAlt} />
    </div>}
</div>}
